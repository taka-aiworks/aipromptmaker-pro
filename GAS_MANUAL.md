# 🎨 AI Prompt Maker - Google Apps Script連携 完全マニュアル

## 📖 目次
1. [概要](#概要)
2. [事前準備](#事前準備)
3. [GAS側の設定](#gas側の設定)
4. [クライアント側の設定](#クライアント側の設定)
5. [機能の使い方](#機能の使い方)
6. [トラブルシューティング](#トラブルシューティング)
7. [よくある質問](#よくある質問)

---

## 🌟 概要

このGAS連携機能により、AI Prompt Makerで生成したデータを**自動的にGoogle Driveに保存**できます。

### ✨ 主な機能
- **CSV自動保存**: 学習データ・量産データをスプレッドシート形式で保存
- **自動バックアップ**: 設定データの定期バックアップ
- **プリセット保存**: カスタムプリセットのクラウド保存
- **ログ管理**: 使用状況の自動記録
- **CORS完全対応**: ブラウザ制限を回避した安定通信

---

## 🚀 事前準備

### 必要なもの
- Googleアカウント
- インターネット接続
- AI Prompt Makerの最新版

### 推定作業時間
- **初回設定**: 約10-15分
- **日常使用**: 設定後は自動動作

---

## ⚙️ GAS側の設定

### ステップ1: Google Apps Scriptにアクセス

1. ブラウザで [https://script.google.com/](https://script.google.com/) を開く
2. Googleアカウントでログイン

### ステップ2: 新しいプロジェクトを作成

1. 「新しいプロジェクト」をクリック
2. プロジェクト名を「AI Prompt Maker - GAS連携」に変更（推奨）

### ステップ3: コードの貼り付け

1. デフォルトの`Code.gs`をすべて削除
2. 提供されたGASコードをコピー&ペースト
3. `Ctrl+S`（または`Cmd+S`）で保存

### ステップ4: 初期セットアップの実行

1. 関数選択で `setupGAS` を選択
2. ▶️ 実行ボタンをクリック
3. 初回実行時の承認画面：
   - 「権限を確認」→「詳細」→「AI Prompt Maker - GAS連携（安全ではないページ）に移動」
   - 「許可」をクリック

**実行結果例：**
```
🚀 AI Prompt Maker GAS セットアップ開始
✅ フォルダ作成完了
✅ ログシート作成完了
✅ トリガー設定完了
🎉 セットアップ完了!
```

### ステップ5: Webアプリとしてデプロイ

1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 「種類を選択」で ⚙️ アイコン→「ウェブアプリ」を選択
3. 設定項目：
   - **説明**: 「AI Prompt Maker連携」（任意）
   - **実行者**: 「自分」を選択 ⚠️**重要**
   - **アクセスできるユーザー**: 「全員」を選択 ⚠️**重要**
4. 「デプロイ」をクリック
5. **WebアプリURLをコピー** 📋（このURLが重要です！）

**URLの例：**
```
https://script.google.com/macros/s/AKfycbx54ytwe4gEqbleG33b.../exec
```

---

## 💻 クライアント側の設定

### ステップ1: AI Prompt Makerを開く

ブラウザでAI Prompt Makerにアクセスします。

### ステップ2: 設定画面を開く

「設定」タブまたはボタンをクリックします。

### ステップ3: GAS連携設定

「☁️ Google Apps Script連携」セクションで以下を設定：

1. **GAS WebアプリURL**: 
   - 先ほどコピーしたURLを貼り付け
2. **認証トークン**: 
   - 空欄のままでOK（セキュリティを強化したい場合のみ設定）
3. **自動バックアップ**: 
   - チェックを入れると定期的に自動バックアップ
   - 間隔は24時間推奨

### ステップ4: 設定の保存と接続テスト

1. 「💾 設定保存」をクリック
2. 「🔌 接続テスト」をクリック
3. **成功メッセージが表示されればOK！** ✅

**成功例：**
```
✅ 接続成功!
📡 接続テスト成功 - 2025/9/6 0:04:11
⏰ 2025-09-06T00:04:11.123Z
```

---

## 🎯 機能の使い方

### 📊 CSV自動保存

#### 学習データの保存
1. AI Prompt Makerで学習データを生成
2. 「☁️ 学習」ボタンをクリック
3. 自動的にGoogle Driveに保存される

**保存先：**
- フォルダ: `AI_Prompt_Maker_CSV`
- ファイル形式: CSVファイル + Googleスプレッドシート

#### 量産データの保存
1. 量産データを生成
2. 「☁️ 量産」ボタンをクリック
3. Google Driveに自動保存

### 💾 自動バックアップ

設定で自動バックアップを有効にすると：
- 指定した間隔で全設定データをバックアップ
- 保存先: `AI_Prompt_Maker_Backups`フォルダ
- 手動実行: 「☁️ 手動バックアップ」ボタン

### 📁 Google Driveでの確認方法

1. [Google Drive](https://drive.google.com/)を開く
2. 以下のフォルダが自動作成されています：
   - `AI_Prompt_Maker_Backups`: バックアップファイル
   - `AI_Prompt_Maker_CSV`: CSVデータとスプレッドシート
   - `AI_Prompt_Maker_Presets`: プリセットファイル

### 📈 ログの確認

使用状況は自動的に記録されます：
1. Google Driveで「AI Prompt Maker - ログ」スプレッドシートを開く
2. 各アクションのタイムスタンプとステータスを確認可能

---

## 🛠️ トラブルシューティング

### ❌ よくあるエラーと解決方法

#### 1. 「GAS URLが設定されていません」
**原因**: WebアプリURLが未設定または間違っている  
**解決**: 
- GASでデプロイしたURLを正確にコピー&ペースト
- URLが`https://script.google.com/macros/s/`で始まっていることを確認

#### 2. 「接続失敗: スクリプトの読み込みに失敗しました」
**原因**: GAS側のデプロイ設定が間違っている  
**解決**: 
- デプロイ設定で「実行者: 自分」「アクセス: 全員」を確認
- 新しいバージョンでデプロイし直す

#### 3. 「認証に失敗しました」
**原因**: トークン設定の不一致  
**解決**: 
- クライアント側の認証トークンを空欄にする
- またはGAS側の`AUTH_TOKEN`を設定する

#### 4. 「フォルダ作成エラー」
**原因**: Google Driveの容量不足またはアクセス権限  
**解決**: 
- Google Driveの容量を確認
- `setupGAS()`を再実行

### 🔍 詳細なデバッグ方法

#### GAS側のログ確認
```javascript
// GASエディタで実行
function testEndpoint() {
  var result = testEndpoint();
  console.log("テスト結果:", result);
}
```

#### ブラウザのコンソール確認
1. F12キーでデベロッパーツールを開く
2. Consoleタブでエラーメッセージを確認
3. 赤いエラーメッセージがある場合は、その内容を確認

### 🔄 リセット手順

問題が解決しない場合：

1. **クライアント側**: 「🗑️ リセット」ボタンをクリック
2. **GAS側**: 新しいプロジェクトを作成して最初からやり直し

---

## ❓ よくある質問

### Q1. 料金はかかりますか？
**A**: 基本的に無料です。Google Driveの容量制限（15GB）内であれば追加料金はありません。

### Q2. データの安全性は？
**A**: データはあなたのGoogle Driveに保存され、Googleのセキュリティ基準で保護されます。第三者がアクセスすることはできません。

### Q3. 複数のデバイスで使えますか？
**A**: はい。同じGoogleアカウントであれば、異なるデバイスからも同じデータにアクセスできます。

### Q4. 過去のデータを削除したい
**A**: Google Driveで該当フォルダを開き、不要なファイルを手動で削除してください。90日以上古いファイルは自動削除されます。

### Q5. 他の人とデータを共有したい
**A**: Google Driveの共有機能を使って、フォルダまたは個別ファイルを共有できます。

### Q6. バックアップから復元する方法は？
**A**: 現在はバックアップ保存のみ対応。復元機能は今後のアップデートで追加予定です。

### Q7. エラーが続く場合は？
**A**: 以下の順序で確認してください：
1. インターネット接続を確認
2. ブラウザを再起動
3. GASのデプロイURLを再確認
4. 設定をリセットして再設定

---

## 🔧 高度な設定

### セキュリティ強化（認証トークン）

より安全に使用したい場合：

1. **GAS側で設定**:
```javascript
function getConfig() {
  var config = {
    AUTH_TOKEN: "your_secret_token_here", // 任意の文字列
    // ... 他の設定
  };
  return config;
}
```

2. **クライアント側で同じトークンを設定**

### 自動クリーンアップの調整

古いファイルの削除期間を変更：

```javascript
function cleanupOldFiles() {
  var cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - 30); // 30日に変更
  // ... 処理続行
}
```

---

## 📞 サポート

### 問題が解決しない場合

1. **エラーメッセージの詳細**をコピー
2. **実行した手順**を整理
3. **ブラウザとOS**の情報を確認
4. 開発者に報告

### アップデート情報

機能追加や改善は随時実施されます。新しいバージョンがリリースされた場合：

1. GAS側のコードを更新
2. 新しいバージョンでデプロイ
3. クライアント側のコードも更新

---

## 🎉 まとめ

この連携機能により、AI Prompt Makerで生成したデータが自動的にGoogle Driveに整理保存され、データの管理と共有が格段に便利になります。

設定は一度だけ行えば、その後は自動的に動作します。ぜひ活用して、より効率的なAI活用を実現してください！

**Happy Prompting! 🚀**
